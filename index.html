<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>htmlメモ</title>
<style>
    /* テキストエリアのスタイルを定義 */
    #textarea {
        outline: none;
        width: 100%;            /* 横幅を画面いっぱいに */
        min-height: 200px;      /* 最低限の高さ（クリックしやすくするため） */
        white-space: pre-wrap;  /* 改行やスペースを維持しつつ、端で折り返す */
        word-break: break-all;  /* 長い英数字でも強制的に端で折り返す */
        overflow-wrap: break-word; /* ブラウザの端で単語を区切る */
    }
</style>
</head>

<body>
    <script type="text/javascript">
        window.onload = function(){
            var textvalue = localStorage.getItem('text');
            const textareavalue = document.getElementById('textarea');
            if(textareavalue.innerHTML){
                // すでにHTML内に記述がある場合は何もしない
            }else if (textvalue) {
                textareavalue.innerHTML = textvalue;
            }else{
                textareavalue.innerHTML = "編集可能エリア";
            }
        }     

        window.onbeforeunload = function() {
            const textareavalue = document.getElementById('textarea');
            localStorage.setItem('text', textareavalue.innerHTML);
        }
     
        function buttonClick(){
            var savehtml = new XMLSerializer().serializeToString(document);
            var blob = new Blob([savehtml], { "type" : "text/plain" });
            let link = document.createElement('a'); 
            link.href = URL.createObjectURL(blob);
            link.download = document.getElementById("pagetitle").value;
            link.click(); 
        }

        function localStrageClear(){
            if(confirm("データを消去しますか？")){
                localStorage.removeItem('text');
                var mydiv = document.getElementById("textarea");
                mydiv.innerHTML = "";
            }
        }
    </script>

    <input type="button" value="ファイル出力" onclick="buttonClick();"/>
    <input type="button" value="localStorage & text Clear" onclick="localStrageClear();"/>

    <br>
    <input type="text" id="pagetitle" size="30" value="SavePage.html">

    <br><br>
    <div id="textarea" contentEditable="true"></div>

</body>
</html>
