<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>htmlメモ</title>
    <style>
        body {
            font-family: sans-serif;
            font-size: 16px; 
            line-height: 1.5;
            padding: 10px;
            margin: 0;
        }

        input[type="button"] {
            padding: 10px 15px;
            font-size: 16px;
            margin-bottom: 10px;
            cursor: pointer;
            border: 1px solid #ccc; /* 見やすくするため少し線を付けました */
            background: #eee;
        }

        #pagetitle {
            width: 100%;
            box-sizing: border-box;
            padding: 8px;
            font-size: 16px;
            margin-bottom: 15px;
            border: none;
        }

        #textarea {
            outline: none;
            width: 100%;
            min-height: 300px;
            padding: 10px;
            box-sizing: border-box;
            background-color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-wrap: break-word;
        }

        /* --- 画像リサイズ用の設定 --- */
        #textarea img {
            display: inline-block;
            vertical-align: bottom;
            resize: both;      /* 縦横両方のリサイズを許可 */
            overflow: auto;    /* リサイズ機能に必須 */
            max-width: 100%;   /* 画面からはみ出さないように制限 */
            border: 1px dashed #ccc; /* 編集可能であることがわかるように点線を表示 */
        }
    </style>
</head>

<body>
    <script type="text/javascript">
        window.onload = function(){
            var textvalue = localStorage.getItem('text');
            const textareavalue = document.getElementById('textarea');
            if(textareavalue.innerHTML.trim()){
                // すでに記述がある場合は何もしない
            }else if (textvalue) {
                textareavalue.innerHTML = textvalue;
            }else{
                textareavalue.innerHTML = "編集可能エリア";
            }
        }     

        window.onbeforeunload = function() {
            const textareavalue = document.getElementById('textarea');
            localStorage.setItem('text', textareavalue.innerHTML);
        }
     
        function buttonClick(){
            var savehtml = new XMLSerializer().serializeToString(document);
            var blob = new Blob([savehtml], { "type" : "text/html" });
            let link = document.createElement('a'); 
            link.href = URL.createObjectURL(blob);
            link.download = document.getElementById("pagetitle").value;
            link.click(); 
        }

        function localStrageClear(){
            if(confirm("データを消去しますか？")){
                localStorage.removeItem('text');
                var mydiv = document.getElementById("textarea");
                mydiv.innerHTML = "";
            }
        }

        // ペースト時に画像が貼り付けられた場合、自動でスタイルを適用する補助処理
        document.addEventListener('paste', function (e) {
            setTimeout(() => {
                const images = document.querySelectorAll('#textarea img');
                images.forEach(img => {
                    if (!img.style.width) {
                        img.style.width = "200px"; // 初期サイズを指定（お好みで）
                    }
                });
            }, 10);
        });
    </script>

    <input type="button" value="ファイル出力" onclick="buttonClick();"/>
    <input type="button" value="全消去" onclick="localStrageClear();"/>

    <hr>
    <label style="font-size: 14px; color: #666;">保存ファイル名：</label><br>
    <input type="text" id="pagetitle" value="SavePage.html">

    <hr>
    <div id="textarea" contentEditable="true"></div>

</body>
</html>